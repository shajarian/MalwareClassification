import os
import json
import pandas as pd

directory_path = '/home/aima/AIMA/4/cuckoo_reports'

all_reports = {}

for filename in os.listdir(directory_path):
    if filename.endswith('.json'):
        file_path = os.path.join(directory_path, filename)
        with open(file_path, 'r') as file:
            data = json.load(file)
            apistats = data.get('behavior', {}).get('apistats', {})
            report_data = {}
            for process, api_calls in apistats.items():
                for api_call, count in api_calls.items():
                    report_data[api_call] = report_data.get(api_call, 0) + count
            report_data['Malware'] = 0 if 'BENIGN' in filename else 1
            all_reports[filename] = report_data


with open('/home/aima/AIMA/4/extraction_output.json', 'w') as outfile:
    json.dump(all_reports, outfile, indent=4)

df = pd.DataFrame.from_dict(all_reports, orient='index').fillna(0).astype(int)
print(df.head)
print(df['Malware'])
df.to_csv('/home/aima/AIMA/4/formatted_data.csv')
